
 [Skip to content](#VPContent) [![](/agoric-logo-red.svg)Agoric Documentation](/)Search`K` Main Navigation Orchestrate[What is Agoric Orchestration?](/guides/orchestration/)[Key Concepts and APIs](/guides/orchestration/key-concepts.html)

Contract Walkthroughs

[Send Anywhere Example](/guides/orchestration/contract-walkthroughs/send-anywhere.html)[Cross-Chain Unbond Example](/guides/orchestration/contract-walkthroughs/cross-chain-unbond.html)

Example Orchestration DApp

[Installation and Deployment](/guides/orchestration/orchestration-basics/installation.html)[Orca Contract walkthrough](/guides/orchestration/orchestration-basics/contract.html)[UI Walkthrough](/guides/orchestration/orchestration-basics/ui.html)[How Orchestration Works](/guides/orchestration/how-orch-works.html)Build[Getting Started](/guides/getting-started/)[Smart Contract Basics](/guides/zoe/contract-basics.html)[UI Component Library](/guides/UIComponentLibrary/)[Building Client Dapps](/guides/getting-started/contract-rpc.html)[Permissioned Contract Deployment](/guides/coreeval/)[Integrating with Agoric Network](/guides/integration/chain-integration.html)[Agoric CLI](/guides/agoric-cli/)[Agoric API Reference](https://agoric-sdk.pages.dev/)[Endo API Reference](https://endojs.github.io/endo/)[ERTP API](/reference/ertp-api/)[Zoe API](/reference/zoe-api/)[Example Zoe Contracts](/guides/zoe/contracts/)[End-to-End Testing](/e2e-testing.html)Learn[What is Agoric?](/what-is-agoric.html)[Agoric Platform](/guides/platform/)[Zoe Smart Contract Framework](/guides/zoe/)[ERTP](/guides/ertp/)[JavaScript Framework](/guides/js-programming/)[Deployed Zoe Contracts](/guides/zoe/actual-contracts/)[Glossary](/glossary/)[Papers](https://agoric.com/papers/)Tutorials[Tutorial: Dapp with Agoric](/guides/getting-started/tutorial/)[dapp-agoric-basics](/guides/getting-started/tutorial-dapp-agoric-basics.html)[UI Tutorial](/guides/getting-started/ui-tutorial/)Support[Agoric](https://agoric.com/)[Discord](https://agoric.com/discord)[Github Discussions (Q&A)](https://github.com/Agoric/agoric-sdk/discussions)[Office Hours](https://github.com/Agoric/agoric-sdk/wiki/Office-Hours)[Twitter](https://twitter.com/agoric)[YouTube](https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/)[Github](https://github.com/Agoric/)

Appearance

MenuReturn to top Sidebar Navigation 

Orchestrate
-----------

[What is Agoric Orchestration?](/guides/orchestration/)[Key Concepts and APIs](/guides/orchestration/key-concepts.html)[### Contract Walkthroughs](/guides/orchestration/contract-walkthroughs/)[Send Anywhere Example](/guides/orchestration/contract-walkthroughs/send-anywhere.html)[Cross-Chain Unbond Example](/guides/orchestration/contract-walkthroughs/cross-chain-unbond.html)[### Example Orchestration DApp](/guides/orchestration/orchestration-basics/)[Installation and Deployment](/guides/orchestration/orchestration-basics/installation.html)[Orca Contract walkthrough](/guides/orchestration/orchestration-basics/contract.html)[UI Walkthrough](/guides/orchestration/orchestration-basics/ui.html)[How Orchestration Works](/guides/orchestration/how-orch-works.html)

Build
-----

[### Getting Started](/guides/getting-started/)[Takeaway 1: Starting a Local Chain](/guides/getting-started/explainer-how-to-start-a-local-chain.html)[Takeaway 2: Deploying a Smart Contract](/guides/getting-started/explainer-deploying-a-smart-contact.html)[Takeaway 3: Making an Offer](/guides/getting-started/explainer-how-to-make-an-offer.html)[### Smart Contract Basics](/guides/zoe/contract-basics.html)[Hello World Smart Contract](/guides/zoe/contract-hello.html)[State Smart Contract](/guides/zoe/contract-state.html)[Access Control Smart Contract](/guides/zoe/contract-access-control.html)[Complete Contract Walk-Through](/guides/zoe/contract-walkthru.html)[Durable Contract Details](/guides/zoe/contract-details.html)[Contract Upgrade](/guides/zoe/contract-upgrade.html)[Contract Governance](/guides/governance/)[UI Component Library](/guides/UIComponentLibrary/)[Building Client Dapps](/guides/getting-started/contract-rpc.html)[### Permissioned Contract Deployment](/guides/coreeval/)[Write Code to Deploy a Contract](/guides/coreeval/proposal.html)[Declare Required Capabilities](/guides/coreeval/permissions.html)[Submit Transactions](/guides/coreeval/local-testnet.html)[### Integrating with Agoric Network](/guides/integration/chain-integration.html)[Name Services: agoricNames, namesByAddress, board](/guides/integration/name-services.html)[SubQuery Indexing](/guides/subquery-indexing.html)[### Agoric CLI](/guides/agoric-cli/)[Agoric CLI Reference](/guides/agoric-cli/)[Using agd to make queries and transactions](/guides/agoric-cli/agd-query-tx.html)[Agoric API Reference](https://agoric-sdk.pages.dev/)[Endo API Reference](https://endojs.github.io/endo/)[### ERTP API](/reference/ertp-api/)[ERTP API](/reference/ertp-api/)[Issuer Object](/reference/ertp-api/issuer.html)[Mint Object](/reference/ertp-api/mint.html)[Brand Object](/reference/ertp-api/brand.html)[Purse Object](/reference/ertp-api/purse.html)[Payment Object](/reference/ertp-api/payment.html)[AmountMath Object](/reference/ertp-api/amount-math.html)[ERTP Data Types](/reference/ertp-api/ertp-data-types.html)[### Zoe API](/reference/zoe-api/)[Zoe API](/reference/zoe-api/)[Zoe Service](/reference/zoe-api/zoe.html)[UserSeat Object](/reference/zoe-api/user-seat.html)[Zoe Contract Facet (ZCF)](/reference/zoe-api/zoe-contract-facet.html)[ZCFSeat Object](/reference/zoe-api/zcfseat.html)[ZCFMint Object](/reference/zoe-api/zcfmint.html)[ZoeHelper Functions](/reference/zoe-api/zoe-helpers.html)[Ratio Math Functions](/reference/zoe-api/ratio-math.html)[Zoe Data Types](/reference/zoe-api/zoe-data-types.html)[### Example Zoe Contracts](/guides/zoe/contracts/)[Example Zoe Contracts](/guides/zoe/contracts/)[Oracle Query Contract](/guides/zoe/contracts/oracle.html)[Vault Contract](/guides/zoe/contracts/vault.html)[Loan Contract](/guides/zoe/contracts/loan.html)[Funded Call Spread Contract](/guides/zoe/contracts/fundedCallSpread.html)[Priced Call Spread Contract](/guides/zoe/contracts/pricedCallSpread.html)[Covered Call Contract](/guides/zoe/contracts/covered-call.html)[OTC Desk Contract](/guides/zoe/contracts/otc-desk.html)[ConstantProduct AMM Contract](/guides/zoe/contracts/constantProductAMM.html)[Sell Items Contract](/guides/zoe/contracts/sell-items.html)[Atomic Swap Contract](/guides/zoe/contracts/atomic-swap.html)[Barter Exchange Contract](/guides/zoe/contracts/barter-exchange.html)[Second-Price Auction Contract](/guides/zoe/contracts/second-price-auction.html)[Simple Exchange Contract](/guides/zoe/contracts/simple-exchange.html)[Escrow To Vote Contract](/guides/zoe/contracts/escrow-to-vote.html)[Mint Payments Contract](/guides/zoe/contracts/mint-payments.html)[Mint and Sell NFTs Contract](/guides/zoe/contracts/mint-and-sell-nfts.html)[Use Object Contract](/guides/zoe/contracts/use-obj-example.html)[Automatic Refund Contract](/guides/zoe/contracts/automatic-refund.html)[End-to-End Testing](/e2e-testing.html)

Learn
-----

[What is Agoric?](/what-is-agoric.html)[Agoric Platform](/guides/platform/)[Zoe Smart Contract Framework](/guides/zoe/)[### ERTP](/guides/ertp/)[Amounts, Values, and Brands](/guides/ertp/amounts.html)[AmountMath](/guides/ertp/amount-math.html)[Issuers and Mints](/guides/ertp/issuers-and-mints.html)[Purses and Payments](/guides/ertp/purses-and-payments.html)[JavaScript Framework](/guides/js-programming/)[### Deployed Zoe Contracts](/guides/zoe/actual-contracts/)[PSM Contract](/guides/zoe/actual-contracts/PSM.html)[PriceAuthority Object](/reference/zoe-api/price-authority.html)[Glossary](/glossary/)[Papers](https://agoric.com/papers/)

Tutorials
---------

[Tutorial: Dapp with Agoric](/guides/getting-started/tutorial/)[### dapp-agoric-basics](/guides/getting-started/tutorial-dapp-agoric-basics.html)[Takeaway 1: Sell Concert Tickets Contract Overview](/guides/getting-started/sell-concert-tickets-contract-explainer.html)[Takeaway 2: Swaparoo Contract Overview](/guides/getting-started/swaparoo-how-to-swap-assets-explainer.html)[Takeaway 3: Sending Invitation Payments using an Address](/guides/getting-started/swaparoo-making-a-payment-explainer.html)[### UI Tutorial](/guides/getting-started/ui-tutorial/)[1. Starting](/guides/getting-started/ui-tutorial/starting.html)[2. Agoric Provider](/guides/getting-started/ui-tutorial/agoric-provider.html)[3. Connect Wallet](/guides/getting-started/ui-tutorial/connect-wallet.html)[4. Querying Vstorage](/guides/getting-started/ui-tutorial/querying-vstorage.html)[5. Making an Offer](/guides/getting-started/ui-tutorial/making-an-offer.html)[6. Conclusion](/guides/getting-started/ui-tutorial/conclusion.html)

Support
-------

[Agoric](https://agoric.com/)[Discord](https://agoric.com/discord)[Discussions (Q&A)](https://github.com/Agoric/agoric-sdk/discussions)[Office Hours](https://github.com/Agoric/agoric-sdk/wiki/Office-Hours)[Twitter](https://twitter.com/agoric)[YouTube](https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/)[Github](https://github.com/Agoric/)On this page

Testing [​](#testing)
=====================

Developing Decentralized Applications (DApps) on the Cosmos network often involves integrating with the Keplr wallet. Testing is key for ensuring users can flawlessly interact with your DApp through the Keplr wallet.

[`@agoric/synpress`](https://github.com/agoric-labs/synpress) is an end-to-end (e2e) testing framework that simplifies the testing process for Keplr-based DApps. This framework automates testing how your DApp interacts with the Keplr wallet, simulating real user experiences. `@agoric/synpress` is built upon [`synthetixio/synpress`](https://github.com/Synthetixio/synpress), a framework designed for Metamask-based DApps.

Since `@agoric/synpress` is based on [Cypress](https://www.cypress.io/), the official [Cypress documentation](https://docs.cypress.io/guides/overview/why-cypress) has a lot of information that you can use with `@agoric/synpress`.

Installation [​](#installation)
-------------------------------

Before you start testing your DApp with Keplr, you'll need to install the `@agoric/synpress` in your project using the following command:

bash
```
yarn add -D @agoric/synpress
```

Project structure [​](#project-structure)
-----------------------------------------

We recommend the following project structure for keeping your e2e tests clean and manageable:

text
```
project_dir
└── src
└── tests
    └── e2e
        └── synpress.config.js
        └── support.js
        └── specs
            └── test.spec.js
```

Configure `synpress.config.js` [​](#configure-synpress-config-js)
-----------------------------------------------------------------

Before you start writing your E2E tests, you'll need to create a configuration file named `synpress.config.js` in the `tests/e2e` directory of your project.

Inside `synpress.config.js`, you'll set the `baseUrl` property within the e2e configuration. This tells Cypress where to find your DApp during testing. Here's an example configuration:

js
```
const baseConfig = require('@agoric/synpress/synpress.config');
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  ...baseConfig,
  e2e: {
    ...baseConfig.e2e,
    baseUrl: 'http://localhost:5173'
  }
});
```

In this example, `baseUrl` is set to `http://localhost:5173`. Make sure to replace this with the actual URL where your DApp is running.

By default, if you don't create a `synpress.config.js` file, `@agoric/synpress` assumes your DApp runs on port 3000 of your local machine (`http://localhost:3000`). Specifying the correct `baseUrl` ensures your tests interact with the right instance of your DApp.

Since you have a separate `synpress.config.js` in the `tests/e2e` folder, you need to specify its location when running your tests. Use the `--configFile` flag with the `synpress run` command:

bash
```
EXTENSION=keplr synpress run --configFile=tests/e2e/synpress.config.js
```

Creating a Support File [​](#creating-a-support-file)
-----------------------------------------------------

Navigate to your project's `tests/e2e` directory and create a new file named `support.js`. This file can be used to create reusable commands that encapsulate common testing actions. For example, you can create a custom command to navigate to a specific page within your application. You can read more about it [over here](https://docs.cypress.io/api/cypress-api/custom-commands).

After creating your `support.js` file, make sure to include the following import statement:

js
```
import '@agoric/synpress/support/index';
```

This import is essential because it brings in the necessary functionalities from `@agoric/synpress` to interact with the Keplr wallet within your e2e tests. Without it, your tests won't be able to leverage the features provided by `@agoric/synpress` for Keplr integration.

Example Tests [​](#example-tests)
---------------------------------

With the environment set up, let's write end-to-end (e2e) tests to test your DApp's functionality. In the `tests/e2e/specs` folder, create a new file with a descriptive name that reflects what it tests (e.g., `user_login.spec.js` or `token_transfer.spec.js`).

### Test Structure [​](#test-structure)

You use `describe` blocks to group related tests together, and `it` blocks to define individual test cases within those groups.

js
```
describe('User Login', () => {
  it('should login with valid credentials', () => {
    // Test steps for login functionality
  });
});
```
### Test 1: Setting Up Keplr Wallet [​](#test-1-setting-up-keplr-wallet)

js
```
it('should setup a Keplr wallet', () => {
  cy.setupWallet({
    secretWords: 'KEPLR_MNEMONIC'
  });
  cy.visit('/');
});
```

This test case simulates setting up a Keplr wallet for your tests, using the `cy.setupWallet` method. Make sure to replace `KEPLR_MNEMONIC` with a 24-word mnemonic phrase. The `setupWallet` method creates a wallet based on the provided mnemonic phrase, which can then be used throughout your test suite.

After setting up the wallet, we visit the root path (`/`) of the DApp using `cy.visit('/')`.

### Test 2: Connecting Keplr Wallet [​](#test-2-connecting-keplr-wallet)

js
```
it('should accept connection with wallet', () => {
  cy.contains('Connect Wallet').click();
  cy.acceptAccess();
});
```

This test simulates a user connecting their Keplr wallet to your DApp. `cy.contains('Connect Wallet')` searches for an element containing the text `Connect Wallet` on the webpage and triggers a click event. `cy.acceptAccess` simulates accepting Keplr wallet access for your DApp.

### Test 3: Signing a Transaction [​](#test-3-signing-a-transaction)

js
```
it('should confirm make an offer transaction', () => {
  cy.contains('Make an Offer').click();
  cy.confirmTransaction();
});
```

This test simulates transaction Signing on your DApp. `cy.contains('Make an Offer')` searches for an element containing the text `Make an Offer` and triggers a click event. `cy.confirmTransaction` simulates confirming a transaction.

### Running the Tests [​](#running-the-tests)

You can now trigger the tests by running this command:

bash
```
EXTENSION=keplr synpress run --configFile=tests/e2e/synpress.config.js
```

Projects Using `@agoric/synpress` [​](#projects-using-agoric-synpress)
----------------------------------------------------------------------

Some examples projects utilizing `@agoric/synpress` for e2e tests:

* [PSM dApp E2E Tests](https://github.com/Agoric/dapp-psm/tree/main/tests/e2e)
* [Wallet dApp E2E Tests](https://github.com/frazarshad/wallet-app/tree/main/test/e2e)

@agoric/synpress Commands [​](#agoric-synpress-commands)
--------------------------------------------------------

The `@agoric/synpress` commands are custom Cypress commands designed for use with Keplr. They provide ready-made functions to interact with Keplr-specific elements and workflows.

### `setupWallet` [​](#setupwallet)

Initializes a Keplr wallet for testing. You can either create a new one or import an existing one using the provided options.

**Arguments:**

(All arguments are optional)

The command takes a single object as an argument with the following keys:

* `secretWords` *(**string**)*: The secret words for the wallet. (default is a predefined mnemonic phrase that represents a wallet address on the Agoric chain)
* `privateKey` *(**string**)*: The private key for the wallet.
* `password` *(**string**)*: The password for the wallet. (default is `Test1234`).
* `walletName` *(**string**)*: The name of the wallet. (default is `My Wallet`).
* `selectedChains` *(**array**)*: The chains to select. (default is an empty array, `[]`).
* `createNewWallet` *(**boolean**)*: Whether to create a new wallet (default is `false`).

**Returns:**

* *(**boolean**)*: `true` if the wallet was set up successfully, `false` otherwise.

### `acceptAccess` [​](#acceptaccess)

Handles the authorization process for connecting the Keplr wallet to a DApp. DApps provide a `Connect Wallet` option to initiate this process.

**Returns:**

* *(**boolean**)*: `true` if access was accepted successfully, `false` otherwise.

### `confirmTransaction` [​](#confirmtransaction)

Handles signing transactions within a DApp using the Keplr wallet. This occurs when a user initiates a transaction, such as sending tokens or interacting with a smart contract.

**Returns:**

* *(**boolean**)*: `true` if transaction was approved successfully, `false` otherwise.

### `disconnectWalletFromDapp` [​](#disconnectwalletfromdapp)

Disconnects the Keplr wallet from all previously connected DApps.

**Returns:**

* *(**boolean**)*:`true` if the disconnection was successful, `false` otherwise.

### `getWalletAddress` [​](#getwalletaddress)

Retrieves the wallet address of the currently active wallet associated with a specified blockchain.

**Arguments:**

* `chainName` *(**string**)*: The name of the blockchain for which you want to obtain the wallet address.

**Returns:**

* *(**string**)*: The wallet address for the specified blockchain.

### `switchWallet` [​](#switchwallet)

Switches the active wallet to the specified wallet by name.

**Arguments:**

* `walletName` *(**string**)*: The name of the wallet you want to switch to. This should match the name used when the wallet was created using the `setupWallet` command.

**Returns:**

* *(**boolean**)*: `true` if the wallet switch was successful, `false` otherwise.

### `addNewTokensFound` [​](#addnewtokensfound)

Adds all the new tokens discovered by the Keplr extension to the user's token portfolio when it connects to a new blockchain network.

**Returns:**

* *(**boolean**)*: `true` if the tokens were successfully added to the user's token portfolio `false` otherwise.

### `getTokenAmount` [​](#gettokenamount)

Retrieves the balance of a specified token in the wallet.

**Arguments:**

* `tokenName` *(**string**)*: The name of the token for which you want to retrieve the balance.

**Returns:**

* *(**number**)*: The amount of the specified token currently held in the wallet.

### `isExtensionWindowActive` [​](#isextensionwindowactive)

Determines whether the Keplr extension window is the currently active tab.

**Returns:**

* *(**boolean**)*:`true` if the Keplr extension window is active, `false` otherwise.

### `switchToExtensionWindow` [​](#switchtoextensionwindow)

Switches the focus to the Keplr extension window tab. Keplr window is used for managing wallet related operations.

**Returns:**

* *(**boolean**)*:`true` if the focus change was successful, `false` otherwise.

### `isCypressWindowActive` [​](#iscypresswindowactive)

Determines whether the Cypress window, where the DApp is running, is the currently active tab.

**Returns:**

* *(**boolean**)*:`true` if the Cypress window is active, `false` otherwise.

### `switchToCypressWindow` [​](#switchtocypresswindow)

Switches the focus to the Cypress window tab.

**Returns:**

* *(**boolean**)*:`true` if the focus change was successful, `false` otherwise.

  

For a full list of commands, you can refer to the [Keplr plugin file](https://github.com/agoric-labs/synpress/blob/dev/plugins/keplr-plugin.js).

 [Help us improve this page!](https://github.com/Agoric/documentation/edit/main/main/e2e-testing.md)

Last Updated: 

Pager[Previous pageAutomatic Refund Contract](/guides/zoe/contracts/automatic-refund.html)[Next pageWhat is Agoric?](/what-is-agoric.html)

© 2024 Agoric Systems Operating Company. All Rights Reserved.



